<!DOCTYPE html>
<html>
<head>
    <title>Web Crawler Visualization</title>
</head>
<body>
    <input type="text" id="urlInput" placeholder="Enter URL to crawl">
    <input type="number" id="depthInput" value="1" min="1">
    <button id="crawlButton">Crawl</button>

    <div id="crawlerOutput">
        <h2>Crawled URLs:</h2>
        <ul id="urlList"></ul>
    </div>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const urlInput = document.getElementById("urlInput");
    const crawlButton = document.getElementById("crawlButton");
    const urlList = document.getElementById("urlList");
    const depthInput = document.getElementById("depthInput");

    let pageCount = 0;
    let baseUrl = "";
    const visitedUrls = new Set();

    crawlButton.addEventListener("click", () => {
        pageCount = 0;
        urlList.innerHTML = "";
        visitedUrls.clear();

        try {
            baseUrl = new URL(urlInput.value);
        } catch (error) {
            console.error("Invalid URL:", error);
            return;
        }

        const maxDepth = parseInt(depthInput.value) || 1;
        crawl(baseUrl, maxDepth, 0);
    });

    async function crawl(url, maxDepth, currentDepth) {
        if (currentDepth > maxDepth || visitedUrls.has(url.toString())) return;
        visitedUrls.add(url.toString()); // Store as string for consistent comparison

        try {
            const response = await fetch(url);
            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, "text/html");

            const listItem = document.createElement("li");
            listItem.textContent = url;
            urlList.appendChild(listItem);

            pageCount++;
            console.log("Crawled pages:", pageCount, url);

            if (currentDepth < maxDepth) {
                const links = doc.querySelectorAll("a");
                for (const link of links) {
                    const href = link.getAttribute("href");
                    if (href && !href.startsWith("#") && !href.startsWith("javascript:")) {
                        try {
                            // Handle relative links by resolving them against the base URL
                            const absoluteUrl = new URL(href, url);

                            // Check if the resolved URL is within the base URL's scope
                            const pathToCheck = absoluteUrl.pathname + absoluteUrl.search;
                            if (
                                absoluteUrl.origin === baseUrl.origin &&
                                pathToCheck.startsWith(baseUrl.pathname)
                            ) {
                                crawl(absoluteUrl, maxDepth, currentDepth + 1);
                            }
                        } catch (error) {
                            console.warn("Invalid URL:", href);
                        }
                    }
                }
            }
        } catch (error) {
            console.error("Error crawling:", error);
        }
    }
});

</script>
</body>
</html>
