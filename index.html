<!DOCTYPE html>
<html>
<head>
    <title>Web Crawler Visualization</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <input type="text" id="urlInput" placeholder="Enter URL to crawl">
    <input type="number" id="depthInput" value="1" min="1">
    <button id="crawlButton">Crawl</button>

    <div id="crawlerOutput">
        <h2>Crawled URLs:</h2>
        <ul id="urlList"></ul>
    </div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const urlInput = document.getElementById("urlInput");
  const crawlButton = document.getElementById("crawlButton");
  const urlList = document.getElementById("urlList");
  const depthInput = document.getElementById("depthInput");

  let pageCount = 0;
  let baseUrl = "";
  const visitedUrls = new Set(); // Set to track visited URLs

  crawlButton.addEventListener("click", () => {
      pageCount = 0;
      urlList.innerHTML = "";
      visitedUrls.clear(); // Clear visited URLs when starting a new crawl
      baseUrl = new URL(urlInput.value);
      const maxDepth = parseInt(depthInput.value) || 1;
      crawl(baseUrl.toString(), maxDepth, 0);
  });

  async function crawl(url, maxDepth, currentDepth) {
      if (currentDepth > maxDepth || visitedUrls.has(url)) return; // Check if URL has been visited
      visitedUrls.add(url); // Mark the URL as visited

      try {
          const response = await fetch(url);
          const html = await response.text();
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, "text/html");

          const listItem = document.createElement("li");
          listItem.textContent = url;
          urlList.appendChild(listItem);

          pageCount++;
          console.log("Crawled pages:", pageCount);

          if (currentDepth < maxDepth) {
              const links = doc.querySelectorAll("a");
              for (const link of links) {
                  const href = link.getAttribute("href");
                  if (href) {
                      const absoluteUrl = new URL(href, baseUrl);
                      if (absoluteUrl.origin === baseUrl.origin && absoluteUrl.pathname.startsWith(baseUrl.pathname)) {
                          crawl(absoluteUrl.toString(), maxDepth, currentDepth + 1);
                      }
                  }
              }
          }
      } catch (error) {
          console.error("Error crawling:", error);
      }
  }
});

</script>
</body>
</html>
